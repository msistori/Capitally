<form *ngIf="form" [formGroup]="form" (ngSubmit)="submit()" class="form">

  <!-- Amount & currency -->
  <div class="amount-currency">
    <input matInput type="number" step="1" formControlName="amount" class="amount-field" placeholder="0" />

    <mat-select formControlName="currencyCode" panelClass="currency-panel-class" class="currency-panel">
      <mat-option *ngFor="let cur of currencies" [value]="cur.code" class="currency-item">{{ cur.code }}</mat-option>
    </mat-select>
  </div>

  <!-- Account -->
  <mat-select class="account-field" panelClass="account-panel-class" formControlName="accountId"
    placeholder="{{ 'FORM.ACCOUNT' | translate }}">
    <mat-option *ngFor="let acc of accounts" class="account-option" [value]="acc.id">{{ acc.name }}</mat-option>
  </mat-select>

  <!-- Date picker -->
  <div class="calendar-card">
    <div class="cal-header">
      <button type="button" (click)="prevWeek('date')"><img [src]="utils.getIcon('arrow-left')" alt="<" /></button>
      <div class="month-label">
        {{ form.get('date')!.value | date:'MMMM yyyy' }}
      </div>
      <button type="button" (click)="nextWeek('date')"><img [src]="utils.getIcon('arrow-right')" alt=">" /></button>
    </div>

    <div class="weekdays">
      <span *ngFor="let wd of weekDays">{{ wd }}</span>
    </div>

    <div class="week">
      <span class="day" *ngFor="let d of currentWeekDate" [class.empty]="!d" [class.selected]="isSelected(d, 'date')"
        (click)="selectDay(d, 'date')">
        {{ d?.getDate() }}
      </span>
    </div>
  </div>

  <!-- Income / expense -->
  <mat-button-toggle-group formControlName="transactionType" class="type-toggle" appearance="legacy">
    <mat-button-toggle type="button" value="INCOME">{{ 'FORM.TYPE.INCOME' | translate }}</mat-button-toggle>
    <mat-button-toggle type="button" value="EXPENSE">{{ 'FORM.TYPE.EXPENSE' | translate }}</mat-button-toggle>
  </mat-button-toggle-group>

  <!-- Categories -->
  <div class="category-selector">
    <button *ngFor="let cat of recentCategories" class="category-item"
      [class.active]="selectedCategory === cat.category" (click)="selectCategory(cat)" type="button">
      <span class="category-item-macro">{{ cat.macroCategory }}</span>
      <img [src]="utils.getIcon(cat.iconName)" [alt]="cat.category" />
      <span>{{ cat.category }}</span>
    </button>

    <button type="button" class="category-more" [class.active]="selectedCategory === plus.name"
      (click)="openAllCategories()">
      <img [src]="plus.icon" [alt]="plus.name" />
      <span>{{ plus.name | translate }}</span>
    </button>
  </div>

  <!-- Description -->
  <mat-form-field appearance="fill" class="description-field">
    <mat-label>{{ 'FORM.DESCRIPTION' | translate }}</mat-label>
    <input matInput rows="2" formControlName="description" class="description-input" />
  </mat-form-field>

  <!-- Recurring -->
  <div class="recurring-section">
    <mat-slide-toggle formControlName="isRecurring" class="recurring-toggle">
      {{ 'FORM.RECURRING.LABEL' | translate }}
    </mat-slide-toggle>

    <div class="recurring-fields" *ngIf="form.get('isRecurring')?.value">
      <mat-select formControlName="recurringPeriod" class="recurring-period-field"
        panelClass="recurring-period-panel-class" placeholder="{{ 'FORM.RECURRING.PERIOD' | translate }}">
        <mat-option *ngFor="let period of recurrencePeriods" [value]="period">
          {{ ('FORM.RECURRING.' + period) | translate }}
        </mat-option>
      </mat-select>

      <div class="calendar-card">
        <mat-label class="recurring-end-date-label">{{ 'FORM.RECURRING.END_DATE' | translate }}</mat-label>
        <div class="cal-header">
          <button type="button" (click)="prevWeek('recurringEndDate')"><img [src]="utils.getIcon('arrow-left')" alt="<" /></button>
          <div class="month-label">
            {{ form.get('recurringEndDate')!.value | date:'MMMM yyyy' }}
          </div>
          <button type="button" (click)="nextWeek('recurringEndDate')"><img [src]="utils.getIcon('arrow-right')" alt=">" /></button>
        </div>

        <div class="weekdays">
          <span *ngFor="let wd of weekDays">{{ wd }}</span>
        </div>

        <div class="week">
          <span class="day" *ngFor="let d of currentWeekRecurringEndDate" [class.empty]="!d" [class.selected]="isSelected(d, 'recurringEndDate')"
            (click)="selectDay(d, 'recurringEndDate')">
            {{ d?.getDate() }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <button mat-raised-button color="#005f73" class="submit-button">
    {{ 'FORM.SUBMIT' | translate }}
  </button>
</form>